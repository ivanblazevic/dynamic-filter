{"version":3,"sources":["dynamicFilter.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","Object","defineProperty","value","AXArray","arguments","last","removeLastItem","splice","Array","default","ExtendedArray_1","Filter","ref","addValue","canAddValue","values","push","isText","onSelect","option","filters","setApplyEnabled","isValueSelected","some","v","checkOptionType","optionType","type","isAutocomplete","isOptions","callback","Filter_1","Filters","options","config","getID","id","save","filterState","map","m","field","localStorage","setItem","JSON","stringify","force","saveState","autoApply","getResult","applyButton","setApplyDisabled","isApplyEnabled","add","lastFilter","getOptionByField","result","filter","loadState","state","parse","getItem","self","forEach","lastAddedFilter","removeLast","isFilterSelected","errorCallback","message","window","DynamicFilter","apply"],"mappings":"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","file":"dynamicFilter.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass AXArray extends Array {\n    constructor() {\n        super(...arguments);\n        this.last = () => {\n            return this[this.length - 1];\n        };\n        this.removeLastItem = () => {\n            this.splice(-1, 1);\n        };\n    }\n}\nexports.default = AXArray;\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ExtendedArray_1 = require(\"./ExtendedArray\");\nclass Filter {\n    constructor(ref) {\n        this.addValue = () => {\n            if (!this.canAddValue())\n                return;\n            this.values.push(\"\"); // add empty value so array can be iterated in html\n        };\n        /**\n        * Cannot add new value if previous value does not exist\n        * or if type is text, text can only have one value\n        */\n        this.canAddValue = () => {\n            return this.values && this.values.last() && !this.isText();\n        };\n        this.onSelect = (option) => {\n            this.values = new ExtendedArray_1.default();\n            this.option = option;\n            this.values.push(\"\");\n            this.filters.setApplyEnabled();\n        };\n        this.isValueSelected = (value) => {\n            return this.values.some(function (v) {\n                return v == value;\n            });\n        };\n        this.checkOptionType = (optionType) => {\n            if (!this.option)\n                return false;\n            return this.option.type == optionType;\n        };\n        this.isAutocomplete = () => {\n            return this.checkOptionType(\"AUTOCOMPLETE\" /* AUTOCOMPLETE */);\n        };\n        this.isOptions = () => {\n            return this.checkOptionType(\"OPTIONS\" /* OPTIONS */);\n        };\n        this.isText = () => {\n            return this.checkOptionType(\"TEXT\" /* TEXT */);\n        };\n        this.callback = ref.callback;\n        this.filters = ref;\n    }\n}\nexports.default = Filter;\n\n},{\"./ExtendedArray\":2}],4:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ExtendedArray_1 = require(\"./ExtendedArray\");\nconst Filter_1 = require(\"./Filter\");\nclass Filters extends ExtendedArray_1.default {\n    constructor(options, config) {\n        super();\n        this.options = options;\n        this.config = config;\n        this.getID = () => {\n            return this.config.id || \"dynamicFilter\";\n        };\n        this.save = () => {\n            // only neccessary stuff will be saved to local storage\n            let filterState = this.map(function (m) {\n                return {\n                    field: m.option.field,\n                    values: m.values\n                };\n            });\n            localStorage.setItem(this.getID(), JSON.stringify(filterState));\n        };\n        /**\n         * @force - boolean: used to override config.autoApply\n         */\n        this.callback = (force) => {\n            if (!this.config)\n                return;\n            if (this.config.saveState)\n                this.save();\n            if (force || this.config.autoApply)\n                this.config.callback(this.getResult());\n        };\n        this.setApplyEnabled = () => {\n            this.applyButton = true;\n        };\n        this.setApplyDisabled = () => {\n            this.applyButton = false;\n        };\n        this.isApplyEnabled = () => {\n            return this.applyButton;\n        };\n        this.add = () => {\n            // Prevent adding filter if no previous selected\n            let lastFilter = this.last();\n            if (lastFilter && !lastFilter.option)\n                return;\n            this.setApplyDisabled();\n            this.push(new Filter_1.default(this));\n        };\n        this.getOptionByField = (options, field) => {\n            let result = options.filter(function (o) {\n                return o.field == field;\n            });\n            if (result.length == 0)\n                throw (\"Cached option field value \" + field + \" not found in options array!\");\n            return result[0];\n        };\n        this.loadState = () => {\n            let state = JSON.parse(localStorage.getItem(this.getID()));\n            if (!state)\n                return;\n            var self = this;\n            state.forEach(function (s) {\n                if (!s.values)\n                    return;\n                self.add();\n                let lastAddedFilter = self.last();\n                let option = self.getOptionByField(self.options, s.field);\n                lastAddedFilter.onSelect(option);\n                // add values\n                s.values.forEach(function (v) {\n                    lastAddedFilter.addValue();\n                    lastAddedFilter.values[lastAddedFilter.values.length - 1] = v;\n                });\n            });\n        };\n        this.removeLast = () => {\n            this.removeLastItem();\n            this.callback();\n            if (this.length == 0)\n                this.applyButton = false;\n        };\n        this.isFilterSelected = (option) => {\n            return this.some(function (f) {\n                return f.option && f.option.field == option.field;\n            });\n        };\n        this.getResult = () => {\n            let self = this;\n            let result = this.map(function (m) {\n                var o = {};\n                if (!m.option) {\n                    if (self.config.errorCallback)\n                        self.config.errorCallback({ code: 2, message: \"Select option before getting result\" });\n                    return;\n                }\n                // mapping to loose all functions and other unnesesasrry properties\n                o[m.option.field] = m.values.map(function (m) { return m; });\n                return o;\n            });\n            // with map there will always at least one result\n            return result[0];\n        };\n        if (!options)\n            throw (\"Options not passed to DynamicFilter constructor!\");\n        if (!config)\n            throw (\"Callback not passed to DynamicFilter constructor!\");\n        // TODO: should be handled properly; constructor has been called when this.splice is executed?\n        //if (!config || !options) return;\n        if (config.autoApply == null)\n            config.autoApply = true;\n        this.config = config;\n        if (this.config.saveState) {\n            this.loadState();\n            this.config.callback(this.getResult());\n        }\n    }\n}\nexports.Filters = Filters;\nwindow.DynamicFilter = Filters;\n\n},{\"./ExtendedArray\":2,\"./Filter\":3}],5:[function(require,module,exports){\narguments[4][1][0].apply(exports,arguments)\n},{\"dup\":1}]},{},[1,2,3,4,5]);\n"]}